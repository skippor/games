<!DOCTYPE html><html><head><meta http-equiv="Content-Type"content="text/html; charset=UTF-8"><title>2048</title><style>#gridPanel{width:240px;height:240px;margin:0 auto;background-color:#bbada0;border-radius:5px;position:relative;}.grid,.cell{width:50px;height:50px;border-radius:3px;}.grid{float:left;margin:8px 0 0 8px;background-color:#ccc0b3;}.cell{text-align:center;line-height:50px;color:#776e65;font-size:30px;position:absolute;}#c00,#c01,#c02,#c03{top:8px;}#c00,#c10,#c20,#c30{left:8px;}#c10,#c11,#c12,#c13{top:66px;}#c01,#c11,#c21,#c31{left:66px;}#c20,#c21,#c22,#c23{top:124px;}#c02,#c12,#c22,#c32{left:124px;}#c30,#c31,#c32,#c33{top:182px;}#c03,#c13,#c23,#c33{left:182px;}.n2{background-color:#eee3da}.n4{background-color:#ede0c8}.n8{background-color:#f2b179}.n16{background-color:#f59563}.n32{background-color:#f67c5f}.n64{background-color:#f65e3b}.n128{background-color:#edcf72}.n256{background-color:#edcc61}.n512{background-color:#9c0}.n1024{background-color:#33b5e5}.n2048{background-color:#09c}.n4096{background-color:#a6c}.n8192{background-color:#93c}.n8,.n16,.n32,.n64,.n128,.n256,.n512,.n1024,.n2048,.n4096,.n8192{color:#fff}.n1024,.n2048,.n4096,.n8192{font-size:20px}
p{width:240px;margin:0 auto;font-family:Arial;font-weight:bold;font-size:20px;padding-top:7.5px;}#gameOver{display:none;width:100%;height:100%;position:absolute;top:0px;left:0px;}#gameOver div{width:100%;height:100%;background-color:#555;opacity:0.5;}#gameOver p{border-radius:5px;position:absolute;top:100px;left:30%;width:150px;height:100px;border:1px solid#edcf72;line-height:1.6em;text-align:center;background-color:#fff;}.button{padding:5px;border-radius:3px;background-color:#9f8b77;color:#fff;cursor:pointer;}</style><script>function Task(obj,topStep,leftStep){this.obj=obj;this.topStep=topStep;this.leftStep=leftStep;}
Task.prototype.moveStep=function(){var style=getComputedStyle(this.obj,null);var top=parseInt(style.top);var left=parseInt(style.left);this.obj.style.top=top+this.topStep+"px";this.obj.style.left=left+this.leftStep+"px";}
Task.prototype.clear=function(){this.obj.style.left="";this.obj.style.top="";}
var animation={times:10,interval:10,timer:null,tasks:[],addTask:function(source,target){console.log(source+","+target);var sourceDiv=document.getElementById("c"+source);var targetDiv=document.getElementById("c"+target);var sourceStyle=getComputedStyle(sourceDiv);var targetStyle=getComputedStyle(targetDiv);var topStep=(parseInt(targetStyle.top)-
parseInt(sourceStyle.top))/this.times;var leftStep=(parseInt(targetStyle.left)-
parseInt(sourceStyle.left))/this.times;var task=new Task(sourceDiv,topStep,leftStep);this.tasks.push(task);},start:function(){this.timer=setInterval(function(){for(var i=0;i<animation.tasks.length;i++){animation.tasks[i].moveStep();}
animation.times--;if(animation.times==0){for(var i=0;i<animation.tasks.length;i++){animation.tasks[i].clear();}
clearInterval(animation.timer);animation.timer=null;animation.tasks=[];animation.times=10;}},this.interval);}}</script><script>var game={data:[],score:0,state:1,RUNNING:1,GAME_OVER:0,PLAYING:2,start:function(){this.data=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];this.score=0;this.state=this.RUNNING;var div=document.getElementById("gameOver");div.style.display="none";this.randomNum();this.randomNum();this.updateView();},isFull:function(){for(var row=0;row<4;row++){for(var col=0;col<4;col++){if(this.data[row][col]==0){return false;}}}
return true;},randomNum:function(){if(this.isFull()){return;}
while(true){var row=Math.floor(Math.random()*4);var col=Math.floor(Math.random()*4);if(this.data[row][col]==0){this.data[row][col]=Math.random()<0.5?2:4;break;}}},canLeft:function(){for(var row=0;row<4;row++){for(var col=1;col<4;col++){if(this.data[row][col]!=0){if(this.data[row][col-1]==0||this.data[row][col-1]==this.data[row][col]){return true;}}}}
return false;},moveLeft:function(){if(this.canLeft()){for(var row=0;row<4;row++){this.moveLeftInRow(row);}
this.state=this.PLAYING;animation.start();setTimeout(function(){game.state=game.RUNNING;game.randomNum();game.updateView();},animation.times*animation.interval);}},moveLeftInRow:function(row){for(var col=0;col<=2;col++){var nextCol=this.getNextRight(row,col);if(nextCol==-1){break;}else{if(this.data[row][col]==0){this.data[row][col]=this.data[row][nextCol];this.data[row][nextCol]=0;animation.addTask(""+row+nextCol,""+row+col);col--;}else if(this.data[row][col]==this.data[row][nextCol]){this.data[row][col]*=2;this.score+=this.data[row][col];this.data[row][nextCol]=0;animation.addTask(""+row+nextCol,""+row+col);}}}},getNextRight:function(row,col){for(var i=col+1;i<4;i++){if(this.data[row][i]!=0){return i;}}
return-1;},updateView:function(){for(var row=0;row<4;row++){for(var col=0;col<4;col++){var div=document.getElementById("c"+row+col);div.innerHTML=this.data[row][col]==0?"":this.data[row][col];div.className=this.data[row][col]==0?"cell":"cell n"+this.data[row][col];}}
var span=document.getElementById("score");span.innerHTML=this.score;if(this.isGameOver()){this.state=this.GAME_OVER;var div=document.getElementById("gameOver");var finalScore=document.getElementById("finalScore");finalScore.innerHTML=this.score;div.style.display="block";}},canRight:function(){for(var row=0;row<4;row++){for(var col=0;col<3;col++){if(this.data[row][col]!=0){if(this.data[row][col+1]==0||this.data[row][col]==this.data[row][col+1]){return true;}}}}return false;},moveRight:function(){if(this.canRight()){for(var row=0;row<4;row++){this.moveRightInRow(row);}
this.state=this.PLAYING;animation.start();setTimeout(function(){game.state=game.RUNNING;game.randomNum();game.updateView();},animation.times*animation.interval);}},moveRightInRow:function(row){for(var col=3;col>0;col--){var nextCol=this.getNextLeft(row,col);if(nextCol==-1){break;}else{if(this.data[row][col]==0){this.data[row][col]=this.data[row][nextCol];this.data[row][nextCol]=0;animation.addTask(""+row+nextCol,""+row+col);col++;}else if(this.data[row][col]==this.data[row][nextCol]){this.data[row][col]*=2;this.score+=this.data[row][col];this.data[row][nextCol]=0;animation.addTask(""+row+nextCol,""+row+col);}}}},getNextLeft:function(row,col){for(var i=col-1;i>=0;i--){if(this.data[row][i]!=0){return i;}}return-1;},canUp:function(){for(var row=1;row<4;row++){for(var col=0;col<4;col++){if(this.data[row][col]!=0){if(this.data[row-1][col]==0||this.data[row][col]==this.data[row-1][col]){return true;}}}}return false;},moveUp:function(){if(this.canUp()){for(var col=0;col<4;col++){this.moveUpInCol(col);}
this.state=this.PLAYING;animation.start();setTimeout(function(){game.state=game.RUNNING;game.randomNum();game.updateView();},animation.times*animation.interval);}},moveUpInCol:function(col){for(var row=0;row<3;row++){var nextRow=this.getNextDown(row,col);if(nextRow==-1){break;}else{if(this.data[row][col]==0){this.data[row][col]=this.data[nextRow][col];this.data[nextRow][col]=0;animation.addTask(""+nextRow+col,""+row+col);row--;}else if(this.data[row][col]==this.data[nextRow][col]){this.data[row][col]*=2;this.score+=this.data[row][col];this.data[nextRow][col]=0;animation.addTask(""+nextRow+col,""+row+col);}}}},getNextDown:function(row,col){for(var i=row+1;i<4;i++){if(this.data[i][col]!=0){return i;}}return-1;},canDown:function(){for(var row=0;row<3;row++){for(var col=0;col<4;col++){if(this.data[row][col]!=0){if(this.data[row+1][col]==0||this.data[row][col]==this.data[row+1][col]){return true;}}}}return false;},moveDown:function(){if(this.canDown()){for(var col=0;col<4;col++){this.moveDownInCol(col);}
this.state=this.PLAYING;animation.start();setTimeout(function(){game.state=game.RUNNING;game.randomNum();game.updateView();},animation.times*animation.interval);}},moveDownInCol:function(col){for(var row=3;row>0;row--){var nextRow=this.getNextUp(row,col);if(nextRow==-1){break;}else{if(this.data[row][col]==0){this.data[row][col]=this.data[nextRow][col];this.data[nextRow][col]=0;animation.addTask(""+nextRow+col,""+row+col);row++;}else if(this.data[row][col]==this.data[nextRow][col]){this.data[row][col]*=2;this.score+=this.data[row][col];this.data[nextRow][col]=0;animation.addTask(""+nextRow+col,""+row+col);}}}},getNextUp:function(row,col){for(var i=row-1;i>=0;i--){if(this.data[i][col]!=0){return i;}}return-1;},isGameOver:function(){for(var row=0;row<4;row++){for(var col=0;col<4;col++){if(this.data[row][col]==0){return false;}
if(col<3){if(this.data[row][col]==this.data[row][col+1]){return false;}}
if(row<3){if(this.data[row][col]==this.data[row+1][col]){return false;}}}}return true;}}
var mindis=50;var startX=0,startY=0,direction="";function touchSatrtFunc(evt){try
{var touch=evt.touches[0];var x=Number(touch.pageX);var y=Number(touch.pageY);startX=x;startY=y;}
catch(e){alert('touchSatrtFunc：'+e.message);}}
function touchMoveFunc(evt){try
{evt.preventDefault();var touch=evt.touches[0];var x=Number(touch.pageX);var y=Number(touch.pageY);if(Math.abs((x-startX))>=Math.abs((y-startY))){if(x-startX>=mindis){direction='right'}else if(x-startX<=-mindis){direction='left';}else{direction='无效';}}else{if(y-startY>=mindis){direction='down'}else if(y-startY<=-mindis){direction='up';}else{direction='无效';}}}
catch(e){alert('touchMoveFunc：'+e.message);}}
function touchEndFunc(evt){try{if(game.state!=game.PLAYING){if(game.state==game.RUNNING){switch(direction){case'up':game.moveUp();break;case'down':game.moveDown();break;case'left':game.moveLeft();break;case'right':game.moveRight();break;default:break;}}}}
catch(e){alert('touchEndFunc：'+e.message);}}
function bindEvent(){document.addEventListener('touchstart',touchSatrtFunc,false);document.addEventListener('touchmove',touchMoveFunc,false);document.addEventListener('touchend',touchEndFunc,false);}
function isTouchDevice(){try{document.createEvent("TouchEvent");game.start();bindEvent();}
catch(e){alert("不支持TouchEvent事件！");}}
window.onload=isTouchDevice;</script></head><body><p>Score:<span id="score">0</span></p><div id="gridPanel"><!--背景单元格--><div id="g00"class="grid"></div><div id="g01"class="grid"></div><div id="g02"class="grid"></div><div id="g03"class="grid"></div><div id="g10"class="grid"></div><div id="g11"class="grid"></div><div id="g12"class="grid"></div><div id="g13"class="grid"></div><div id="g20"class="grid"></div><div id="g21"class="grid"></div><div id="g22"class="grid"></div><div id="g23"class="grid"></div><div id="g30"class="grid"></div><div id="g31"class="grid"></div><div id="g32"class="grid"></div><div id="g33"class="grid"></div><!--前景单元格--><div id="c00"class="cell"></div><div id="c01"class="cell"></div><div id="c02"class="cell n2">2</div><div id="c03"class="cell"></div><div id="c10"class="cell"></div><div id="c11"class="cell"></div><div id="c12"class="cell"></div><div id="c13"class="cell"></div><div id="c20"class="cell"></div><div id="c21"class="cell"></div><div id="c22"class="cell"></div><div id="c23"class="cell"></div><div id="c30"class="cell n4">4</div><div id="c31"class="cell"></div><div id="c32"class="cell"></div><div id="c33"class="cell"></div></div><!--Game Over界面--><div id="gameOver"style="display: none;"><div><!--灰色半透明背景--></div><!--前景小窗--><p>Game Over!<br>Score:<span id="finalScore"></span><br><a class="button"id="restart"onclick="game.start()">Try again!</a></p></div></body></html>